generator client {
  provider = "prisma-client-js"
}
datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}
enum Role {
  USER
  ADMIN
  STAFF
}
enum TokenType {
  ACCESS
  REFRESH
  RESET_PASSWORD
  VERIFY_EMAIL
}
enum ContactType {
  PATIENT
  CLIENT
  VENDOR
  OTHER
}
enum BookingStatus {
  PENDING
  CONFIRMED
  CANCELLED
  COMPLETED
}
model User {
  id              String         @id @default(uuid())
  email           String         @unique
  password        String
  name            String?
  role            Role           @default(USER)
  isEmailVerified Boolean        @default(false)
  createdAt       DateTime       @default(now())
  updatedAt       DateTime       @updatedAt
  workspaceId     String?
  workspace       Workspace?     @relation(fields: [workspaceId], references: [id])
  tokens          Token[]
  bookings        Booking[]      @relation("StaffBookings")
  notifications   Notification[]
  sentMessages    Message[]      @relation("SentMessages")
  receivedMessages Message[]     @relation("ReceivedMessages")
}
model Token {
  id          String    @id @default(uuid())
  token       String
  type        TokenType
  expires     DateTime
  blacklisted Boolean   @default(false)
  createdAt   DateTime  @default(now())
  user        User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId      String
}
model Workspace {
  id            String          @id @default(uuid())
  name          String
  slug          String?         @unique
  isActive      Boolean         @default(false)


  createdAt     DateTime        @default(now())
  updatedAt     DateTime        @updatedAt
  users         User[]
  contacts      Contact[]
  bookings      Booking[]
  forms         Form[]
  inventory     InventoryItem[]
  messages      Message[]
  serviceTypes  ServiceType[]
  operatingHours OperatingHours[]
  integrations  IntegrationConfig[]
}
model Contact {
  id          String      @id @default(uuid())
  firstName   String
  lastName    String
  email       String?
  phone       String?
  type        ContactType @default(PATIENT)
  isManualMode Boolean    @default(false)
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt
  workspaceId String
  workspace   Workspace   @relation(fields: [workspaceId], references: [id], onDelete: Cascade)
  bookings    Booking[]
  submissions FormSubmission[]
  messages    Message[]

  @@unique([workspaceId, email])
  @@unique([workspaceId, phone])
}
model Booking {
  id          String        @id @default(uuid())
  title       String
  startTime   DateTime
  endTime     DateTime
  status      BookingStatus @default(PENDING)
  notes       String?
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt
  workspaceId String
  workspace   Workspace     @relation(fields: [workspaceId], references: [id], onDelete: Cascade)
  staffId     String?
  reminderSent Boolean    @default(false)
  staff       User?         @relation("StaffBookings", fields: [staffId], references: [id])
  contactId   String?
  contact     Contact?      @relation(fields: [contactId], references: [id])
}
model Form {
  id          String           @id @default(uuid())
  title       String
  description String?
  type        FormType         @default(JSON)
  schema      Json?
  fileUrl     String?
  createdAt   DateTime         @default(now())
  updatedAt   DateTime         @updatedAt
  workspaceId String
  workspace   Workspace        @relation(fields: [workspaceId], references: [id], onDelete: Cascade)
  serviceTypes ServiceType[]
  submissions FormSubmission[]
}

enum FormType {
  JSON
  PDF
}
model FormSubmission {
  id          String   @id @default(uuid())
  data        Json
  createdAt   DateTime @default(now())
  formId      String
  form        Form     @relation(fields: [formId], references: [id], onDelete: Cascade)
  contactId   String?
  contact     Contact? @relation(fields: [contactId], references: [id])
}
model InventoryItem {
  id          String   @id @default(uuid())
  name        String
  sku         String?
  quantity    Int      @default(0)
  threshold   Int      @default(10)
  usagePerBooking Int @default(0)
  price       Float?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  workspaceId String
  workspace   Workspace @relation(fields: [workspaceId], references: [id], onDelete: Cascade)
}
model Message {
  id          String   @id @default(uuid())
  content     String
  read        Boolean  @default(false)
  createdAt   DateTime @default(now())
  workspaceId String
  workspace   Workspace @relation(fields: [workspaceId], references: [id], onDelete: Cascade)
  senderId    String
  sender      User     @relation("SentMessages", fields: [senderId], references: [id])
  receiverId  String
  receiver    User     @relation("ReceivedMessages", fields: [receiverId], references: [id])
  contactId   String?
  contact     Contact? @relation(fields: [contactId], references: [id])
}

model Notification {
  id        String   @id @default(uuid())
  type      String
  message   String
  read      Boolean  @default(false)
  createdAt DateTime @default(now())
  userId    String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model ServiceType {
  id          String    @id @default(uuid())
  name        String
  duration    Int
  price       Float?
  description String?
  isActive    Boolean   @default(true)
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  workspaceId String
  workspace   Workspace @relation(fields: [workspaceId], references: [id], onDelete: Cascade)
  forms       Form[]
}

model OperatingHours {
  id          String    @id @default(uuid())
  dayOfWeek   Int
  startTime   String
  endTime     String
  isActive    Boolean   @default(true)
  workspaceId String
  workspace   Workspace @relation(fields: [workspaceId], references: [id], onDelete: Cascade)

  @@unique([workspaceId, dayOfWeek])
}

model IntegrationConfig {
  id          String    @id @default(uuid())
  provider    String
  credentials Json
  isActive    Boolean   @default(false)
  workspaceId String
  workspace   Workspace @relation(fields: [workspaceId], references: [id], onDelete: Cascade)

  @@unique([workspaceId, provider])
}